import SConsider, os, pdb

Import('*')

env = SConsider.cloneBaseEnv()
conf = SConsider.Configure(env)
if conf.CheckCHeader('oci.h') and conf.CheckMultipleLibs(['occi', 'clntsh', 'nnz11', 'ociicus', 'ociei', 'sqlplus', 'sqlplusic']):
    conf.env.Append(CPPDEFINES='HAS_ORACLE')
sqlplusbin = conf.CheckExecutable('sqlplus')
env = conf.Finish()

buildSettings = {}
if 'HAS_ORACLE' in env['CPPDEFINES']:
    buildSettings[packagename] = {
        'linkDependencies' : [
            packagename + '.nnz',
            packagename + '.clntsh',
        ],
        'requires' : [
            packagename + '.ociicus',
        ],
    }
    buildSettings['occi'] = {
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['occi'],
            },
        },
    }
    buildSettings['clntsh'] = {
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['clntsh'],
            },
        },
    }
    buildSettings['nnz'] = {
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['nnz11'],
            },
        },
    }
    buildSettings['ociicus'] = { # us language support library
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['ociicus'],
            },
        },
    }
    buildSettings['ociei'] = {  # oci library supporting all character sets
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['ociei'],
            },
        },
    }
    buildSettings['libsqlplus'] = {
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['sqlplus'],
            },
        },
    }
    buildSettings['libsqlplusic'] = {
        'public' : {
            'appendUnique'     : {
                'LIBS'         : ['sqlplusic'],
            },
        },
    }
    if sqlplusbin:
        buildSettings['sqlplusbin'] = {
            'sourceFiles'      : [sqlplusbin],
            'targetType'       : 'PseudoFile',
        }
        buildSettings['sqlplus'] = {
            'targetType'       : 'ProgramApp',
            'runConfig' : {
            },
            'requires' : [
                packagename + '.' + packagename,
                packagename + '.libsqlplus',
                packagename + '.libsqlplusic',
            ],
            'usedTarget'       : packagename + '.sqlplusbin',
        }

SConsider.createTargets(packagename, buildSettings)
